@model JN.Data.Currency
@{
    //ViewBag.Title = "转入";
    JN.Data.User Umodel = null;
    if (JN.Services.UserLoginHelper.CurrentUser() == null)
    {
        Response.Redirect(Url.Action("Index", "Login"));
    }
    else
    {
        Umodel = MvcCore.Unity.Get<JN.Data.Service.IUserService>().Single(JN.Services.UserLoginHelper.CurrentUser().ID);
    }
    Layout = "~/Areas/APP/Views/Shared/_Layout18080102.cshtml";

    string Racoin = JN.Services.Manager.Users.GetWalletAddress((int)Model.WalletCurID, Umodel);
}
<link href="/Theme/App/css/base.css" rel="stylesheet">


<header class="header">
    <div class="header-return mui-action-back">
        @*<a href="javascript:history.go(-1);"></a>*@
    </div>

    <div class="logo">@T(ViewBag.Title)</div>

    <div class="header-btn muiopen">
        <a href="@Url.Action("CurTransferEnterList")?curid=@Model.ID">@T("转入记录")</a>
    </div>
</header>

<section class="container">
    <div class="setting-form">
        <div class="form-widget">
            <form action="" method="get">
                <div class="form-box">

                    <div class="clr-small"></div>
                    <div class="form-group">
                        <label class="form-label fontcolor">@T("转入地址")</label>

                        <div class="form-control">
                            <input value="@Racoin" id="qrcode_address" placeholder="@T("离线地址")" readonly class="primary-input">
                            @*<button type="button" data-value="@Racoin" data-title="@T("离线地址")" id="d_clip_button">@T("复制")</button>*@
                        </div>
                    </div>
                    @if (string.IsNullOrEmpty(Racoin))
                    {
                        <div class="form-submit">
                            <button type="button" id="showaddress" class="form-submit-btn">@T("生成地址")</button>
                        </div>
                    }
                    else
                    {
                        @*<div class="mui-text-center price_box margin-top5">
                                @{
                                    //string url = Request.Url.GetLeftPart(UriPartial.Authority) + "/UserCenter/finance/CurTransferout?address=" + Racoin;
                                    //string url = Request.Url.GetLeftPart(UriPartial.Authority)+ "/home/Ewmzc?address=" + Racoin;
                                    string url = Racoin;
                                    if (Model.NetworkType == (int)JN.Data.Enum.CurrencyNetworkType.Ripple || Model.NetworkType == (int)JN.Data.Enum.CurrencyNetworkType.EOS)
                                    {
                                        url = Model.AccountAddress;
                                    }
                                }
                                <img class="ewm" src="@MvcCore.Extensions.QRCodeExtensions.ToQRCode(url, 5, 5).GetImgBase64String(System.Drawing.Imaging.ImageFormat.Png)" />
                            </div>*@
                        <div class="form-submit">
                            <button type="button" class="form-submit-btn" data-value="@Racoin" data-title="@T("复制离线地址")" id="d_clip_button">@T("复制离线地址")</button>
                        </div>
                        <div class="form-submit">
                            <button type="button" id="createBtn" class="form-submit-btn">@T("同步转入数据")</button>
                        </div>
                    }
                </div>
            </form>
        </div>
    </div>
</section>

@*<div id="zfbPayImg">
        <img src="" alt="" />
    </div>*@

<script>
    $("#createBtn").click(function () {
        var btn = $(this);
        btn.html("加载中....");
        $.post("@(Url.Action("GetListTransactions"))", { curid:@Model.ID}, function (data) {
            if (data.Status == 200) {
                layer.msg("@T("成功获取充值记录")", { icon: 1 }, function () {
                    location = '@(Url.Action("CurTransferEnter"))?curid=@Model.ID';
                });
            }
            else {
                btn.html("@T("同步数据")");
                layer.msg(data.Message);
            }
        });
    });
        @*var timer = setInterval(function(){
            $.post("@(Url.Action("GetListTransactions"))", {curid:@Model.ID}, function (data) {
                if(data.Status==200)
                {
                    layer.msg("@T("成功获取充值记录")");
                }
            });
        },10000);*@

    $("#showaddress").click(function () {
        $("#showaddress").attr("disabled", "disabled");
        $.post("@(Url.Action("AjaxCreateNewAddress"))", { curid: @Model.ID}, function (data) {
            if (data.Status == 200) {
                location.reload();
            } else {
                $('#showaddress').removeAttr("disabled");
                alert(data.Message);
            }
        });
    });
</script>

@*<script type="text/javascript">
    $(document).ready(function () {
        $(".zfb-img").click(function () {
            $("#zfbImg").fadeIn();
        });
        $("#zfbImg").click(function () {
            $(this).fadeOut();
        });

        $("#PfImageurla").click(function () {
            $("#zfbPayImg").fadeIn();
        });
        $("#zfbPayImg").click(function () {
            $(this).fadeOut();
        });
    });
</script>*@

<script src="~/Plugin/clipboard/js/clipboard.min.js"></script>
<script>
    $(function () {
        var clipboard = new Clipboard('#d_clip_button', {
            text: function (e) {
                return $(e).data('value');
            }
        });
        clipboard.on('success', function (e) {
            console.log(e);
            layer.msg($(e.trigger).data('title') + '@T("已复制到剪切板")');
        });

        clipboard.on('error', function (e) {
            console.log(e);
            layer.msg('@T("复制失败")', { icon: 2 });
        });
    });
</script>

