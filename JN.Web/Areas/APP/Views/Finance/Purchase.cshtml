@model JN.Data.Advertise
@{
    Layout = "~/Areas/APP/Views/Shared/_Layout18080102.cshtml";

    JN.Data.User Umodel = null;
    if (JN.Services.UserLoginHelper.CurrentUser() == null)
    {
        Response.Redirect(Url.Action("Index", "Login"));
    }
    else
    {
        Umodel = MvcCore.Unity.Get<JN.Data.Service.IUserService>().Single(JN.Services.UserLoginHelper.CurrentUser().ID);
    }

    var buybank = MvcCore.Unity.Get<JN.Data.Service.IUserBankCardService>().List(x => x.UID == Model.UID).OrderByDescending(x => x.ID);

    string ids = ",";
    if (buybank.Count() > 0)
    {
        foreach (var team in buybank)
        {
            ids += team.BankNameID + ",";
        }
    }
    var bankList = MvcCore.Unity.Get<JN.Data.Service.IUserBankCardService>().List(x => x.UID == Umodel.ID && ids.Contains("," + x.BankNameID.ToString() + ",")).OrderByDescending(x => x.ID);
    var cur = MvcCore.Unity.Get<JN.Data.Service.ICurrencyService>().Single(x => x.ID == Model.CurID);///查找当前币种
}
<link href="/Theme/App/css/user.css" rel="stylesheet">
<header class="header">
    <div class="header-return mui-action-back">
        @*<a href="/APP/Finance/Transaction"></a>*@
    </div>
    <div class="logo text-l">@T(ViewBag.Title)</div>
    <a class="my-mine" href="@Url.Action("AdvertiseOrder", "Advertise",new {status= 1,fromcoid= 1})">@T("交易记录")</a>
</header>

@if (Model.Direction == 1)//购买单 对应的是卖出
{

    <section class="container">
        <div class="padding5">
            <p class="text-c fs54 ccbcae4">@T("卖出")+@Model.CurName<br /><span class="fs7 cf40">@((Model.Quantity - Model.HaveQuantity).ToString("F2"))</span></p>
        </div>
        <div class="form-box">
            <form action="" method="get" id="sellform">
                <input type="hidden" name="adid" value="@Model.ID" id="sellid" />
                <div class="form-group">
                    <label for="exampleInputEmail1">@T("交易金额")</label>
                    <input type="text" class="form-control " placeholder="@T("请输入金额")" value="@Model.Price" readonly>
                    <p>@T("商务钱包可用余额")：<span>@((Umodel.Cur3003 ?? 0).ToString("F2")) </span></p>
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail1">@T("卖出数量")</label>
                    <input type="text" class="form-control" name="quantity" placeholder="@T("请输入数量")">
                    <p>@T("手续费")：<span>@((cur.SellPoundage * 100).ToString("F2"))% </span></p>
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail1">@T("付款方式")</label>
                    <select class="form-control" name="bankID">
                        @if (bankList.Count() > 0)
                        {

                            foreach (var item in bankList)
                            {
                                <option value="@item.ID">@item.BankName:@item.BankCard</option>
                            }

                        }
                        @*<option value="-3003">@T("商务钱包")</option>*@
                    </select>
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">@T("交易密码")</label>
                    <input type="password" class="form-control" name="tradeoutPassword" placeholder="@T("请输入交易密码")">
                </div>
                <button type="button" class="form-submit-btn border1 bgf40" id="sellSubmit">@T("卖出")</button>
            </form>
        </div>
    </section>

    <script>

    $("#sellSubmit").click(function () {
        $('#sellSubmit').attr("disabled", "disabled");
        $.post("@Url.Action("SellSubmit", "Advertise")", $('#sellform').serialize(), function (data) {
            if (data.Status == 200) {
                layer.msg("@T("出售成功")！", { icon: 1 });
                window.location.href = "@Url.Action("AdvertiseOrderDetail", "Advertise")/" + data.Message;
            } else {
                layer.msg(data.Message, { icon: 2 });
                $('#sellSubmit').removeAttr("disabled");
            }
        });
    });

    </script>

}
else
{
    <section class="container">
        <div class="padding5">
            <p class="text-c fs54 ccbcae4">@T(ViewBag.Title)<br /><span class="fs7 cf40">@((Model.Quantity - Model.HaveQuantity).ToString("F2"))</span></p>
        </div>
        <div class="form-box">
            <form action="" method="get" id="buyform">
                <input type="hidden" name="adid" value="@Model.ID" id="sellid" />
                <div class="form-group">
                    <label for="exampleInputEmail1">@T("交易金额")</label>
                    <input type="text" class="form-control " placeholder="@T("请输入金额")" value="@Model.Price" readonly>
                    @*<p>@T("商务钱包可用余额")：<span>@((Umodel.Cur3003 ?? 0).ToString("F2")) </span></p>*@
                </div>
                <div class="form-group">
                    <label for="exampleInputEmail1">@T("买入数量")</label>
                    <input type="text" class="form-control" name="quantity" placeholder="@T("请输入数量")">
                    <p>@T("手续费")：<span>@((cur.SellPoundage * 100).ToString("F2"))% </span></p>
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">@T("交易密码")</label>
                    <input type="password" class="form-control" name="tradeoutPassword" placeholder="@T("请输入交易密码")">
                </div>
                <button type="button" class="form-submit-btn border1 bgf40" id="buySubmit">@T("买入")</button>
            </form>
        </div>
        <div class="padding5">
            <p class="text-c fs54 ccbcae4">
                @T("挂卖者信息")<br />
                @{
                    var sellUser = MvcCore.Unity.Get<JN.Data.Service.IUserService>().Single(Model.UID);
                    var bankDefault = MvcCore.Unity.Get<JN.Data.Service.IUserBankCardService>().Single(x => x.UID == sellUser.ID && x.IsDefault);

                }
                <span class="fs7 cf40">@T("真实姓名"):@sellUser.RealName</span><br />
                @if (bankDefault != null)
                {
                    <span class="fs7 cf40">@T("银行名称"):@bankDefault.BankName</span><br />
                    <span class="fs7 cf40">@T("银行卡号"):@bankDefault.BankCard</span><br />
                    <span class="fs7 cf40">@T("银行开户行"):@bankDefault.BankOfDeposit</span><br />
                    <span class="fs7 cf40">@T("银行户名"):@bankDefault.BankUser</span><br />
                }
                else
                {
                    <span class="fs7 cf40">@T("未完善收款信息"):</span><br />
                }
            </p>
        </div>
    </section>

    <script>
    $("#buySubmit").click(function () {
        $('#buySubmit').attr("disabled", "disabled");
        $.post("@Url.Action("BuySubmit", "Advertise")", $('#buyform').serialize(), function (data) {
            if (data.Status == 200) {
                layer.msg("@T("买入成功")！", { icon: 1 });
                window.location.href = "@Url.Action("AdvertiseOrderDetail", "Advertise")/" + data.Message;
            } else {
                layer.msg(data.Message, { icon: 2 });
                $('#buySubmit').removeAttr("disabled");
            }
        });
    });

    </script>
}
