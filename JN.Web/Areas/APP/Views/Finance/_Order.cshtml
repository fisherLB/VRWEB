
@using Webdiyer.WebControls.Mvc
@model Webdiyer.WebControls.Mvc.PagedList<JN.Data.StockEntrustsTrade>
@{
    JN.Data.User Umodel = JN.Services.UserLoginHelper.CurrentUser();
}
                    <table class="table_list" id="sample-table-1" width="100%" border="0" cellpadding="0" cellspacing="0">
    <thead>
        <tr>
            <th width="15%">@T("创建时间")</th>
            <th width="7%">@T("买/卖")</th>
            <th width="11%">@T("数量")</th>
            <th width="9%">@T("价格")</th>
            <th width="11%">@T("已成交")</th>
            <th width="10%">@T("未成交")</th>
            <th width="10%">@T("手续费")</th>
            <th width="8%">@T("状态")</th>
            <th class="button-column" width="9%">@T("操作")</th>
        </tr>
    </thead>
    <tbody>
        @if (Model.Count > 0)
        {
            for (int i = 0; i < Model.Count; i++)
            {
                var item = Model[i];
                <tr>
                    <td>@item.CreateTime.ToString("yyyy-MM-dd HH:mm:ss")</td>
                    <td class="@(item.Direction == 1 ? "sell" : "buy")">@(typeof(JN.Data.Enum.TradeDirection).GetEnumDesc(item.Direction))</td>
                    <td>@(item.Quantity.ToString("F2"))</td>
                    <td>@item.Price.ToString("F3")</td>
                    <td>@(item.HaveTurnover.ToString("F2"))</td>
                    <td>@((item.Quantity - item.HaveTurnover).ToString("F2"))</td>
                    <td>@(item.Poundage.ToString("F3"))</td>
                    <td class="@(item.Direction == 1 ? "sell" : "buy") @(item.Status == -1 ? "cancelled" : "")">@(typeof(JN.Data.Enum.TTCStatus).GetEnumDesc(item.Status))</td>
                    <td >
                        @if (item.Status >= 0 && item.Status <= 1)
                        {
                            <a title="@T("撤消委托")" href="###" onclick="canceltrade(@item.ID)" >@T("取消交易")</a>
                        }
                    </td>
                </tr>
            }
        }
        else
        {
            <tr>
                <td colspan="8" class="no-data-tips"><span>@T("没有更多数据了~~")</span> </td>
            </tr>
        }
    </tbody>
</table>


                    
<div class="row">
    <div class="col-xs-8" style="margin: 0px 0 0 20px;">
        @Ajax.Pager(Model, new Webdiyer.WebControls.Mvc.PagerOptions
   {
       PageIndexParameterName = "Page",
       FirstPageText = "首页",
       LastPageText = "尾页",
       NextPageText = "下一页",
       PrevPageText = "上一页"
      ,
       CurrentPagerItemTemplate = "<span class=\"current\">{0}</span>",
       DisabledPagerItemTemplate = "<span class=\"disabled\">{0}</span>",
       Id = "badoopager"
   },
                                                                                       new MvcAjaxOptions { UpdateTargetId = "_Transaction", HttpMethod = "Post" })

    </div>
</div>

<script>

    function canceltrade(id) {
        $.post('/App/trade/cancelttc', { id: id }, function (data) {
            if (data == 'ok') {
                if (M.dialog2) {
                    return M.dialog2.show();
                }
                M.dialog2 = jqueryAlert({
                    'content': "@(T("已成功取消委托！"))",
                    'modal': true,
                    'buttons': {
                        '@T("确定")': function () {
                            M.dialog2.close();
                            window.location.reload();
                        }
                    }
                })  
            }
            else
                if (M.dialog2) {
                    return M.dialog2.show();
                }
            M.dialog2 = jqueryAlert({
                'content': data,
                'modal': true,
                'buttons': {
                    '@T("确定")': function () {
                        M.dialog2.close();
                    }
                }
            })
        });
    }
</script>