@using PagedList.Mvc;
@using PagedList;
@model PagedList.PagedList<JN.Data.Shop_Product_Category>
@{
    var list = MvcCore.Unity.Get<JN.Data.Service.IShop_Product_CategoryService>().List(x => x.ParentId == 0);
    Layout = "~/Areas/AdminCenter/Views/Shared/_Layout.cshtml";
}

<div id="content">
    <!-- Breadcrumb -->
    <ul class="breadcrumb">
        <li><a href="@Url.Action("Index", "Home")" class="glyphicons home"><i></i> 首页</a></li>
        <li class="divider"></li>
        <li>@ViewBag.Title</li>
    </ul>
    <div class="separator bottom"></div>

    <div class="innerLR">
        <!-- PAGE CONTENT BEGINS -->
        @*<div class="alert alert-primary">
                <strong>注意</strong> 修改参数后需要 <a class="btn btn-blue" href="@(Url.Action("ClearAllCache", "Home"))">
                    清除所有缓存
                </a> 才会生效，清除缓存所有会员及管理员会被强制登出。

            </div>*@

        <div class="tab-content">
            <div class="table-responsive">
                <form method="get">
                    <div>
                        所有分类：
                        <select id="cateid">
                            <option value="0">顶级</option>
                            @{
                                if (list != null && list.Any())
                                {
                                    foreach (var cate in list.ToList())
                                    {
                                        var childList = MvcCore.Unity.Get<JN.Data.Service.IShop_Product_CategoryService>().List(x => x.ParentId == cate.Id);
                                        <option value="@cate.Id">@cate.Name</option>
                                        if (childList != null && childList.Count() > 0)
                                        {
                                            foreach (var childcate in childList.ToList())
                                            {
                                                var childList2 = MvcCore.Unity.Get<JN.Data.Service.IShop_Product_CategoryService>().List(x => x.ParentId == childcate.Id);
                                                <option value="@childcate.Id">&nbsp;﹄@childcate.Name</option>
                                                if (childList2 != null && childList2.Count() > 0)
                                                {
                                                    foreach (var childcate2 in childList2.ToList())
                                                    {
                                                        <option value="@childcate2.Id">&nbsp;&nbsp;&nbsp;﹄@childcate2.Name</option>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        </select>

                        分类名称：
                        <input type="text" id="name" name="name" />&nbsp;&nbsp;
                        <input type="button" id="btnSave" onclick="addCate()" value="增 加" />
                        <br />
                        <hr />
                    </div>
                    </form>

                        <table id="sample-table-1" class="table table-striped table-bordered table-hover" style="margin-bottom:10px">
                            <tr>
                                <th>
                                    ID
                                </th>
                                
                                <th>
                                    分类名称
                                </th>
                                <th>
                                    分类图片
                                </th>
                                @*<th>
                                    分类样式
                                </th>*@
                                <th>
                                    上级名称
                                </th>
                                @*<th>
                                    首页置顶
                                </th>*@
                                <th>
                                    是否显示
                                </th>
                                <th>
                                    排序
                                </th>
                                <th>
                                    添加时间
                                </th>
                                <th>
                                    
                                </th>
                            </tr>
                            @if (Model != null && Model.Count() > 0)
                            {
                                foreach (var item in Model)
                                {
                                    <tr class="table02-con">
                                        <td>@item.Id</td>
                                        <td>@item.Name</td>
                                        <td><a href="@item.CateImg" target="_blank"><img src="@item.CateImg" style="width:40px;height:40px;" /></a></td>
                                        @*<td>@item.Color</td>*@
                                        <td>@item.parentName</td>
                                        @*<td><input type="checkbox" data-value="@item.Id" onclick="HomeTop(this)" @(item.IsNavTop == true ? "checked" : "") /></td>*@
                                        <td><input type="checkbox" data-value="@item.Id" onclick="HomeShow(this)" @(item.IsShow == true ? "checked" : "") /></td>
                                        <td>@item.Sort</td>
                                        <td>@item.CreateTime</td>
                                        <td style="text-align:center">
                                            <a href="@Url.Action("ModifyCategory")?id=@item.Id">编辑</a>
                                        </td>
                                    </tr>
                                }
                            }
                        </table>
                        <div class="separator top form-inline small">

                            <!-- Pagination -->
                            @Html.PagedListPager((IPagedList)Model, page => Url.Action(ViewContext.RouteData.Values["action"].ToString(),
                       JN.Services.Tool.StringHelp.GetQueryString(HttpUtility.ParseQueryString(Request.Url.Query), page)), new PagedListRenderOptions() { ContainerDivClasses = new string[] { "pagination pagination-small pull-right" } })


                            @*<div class="clearfix"></div>*@
                            <!-- // Pagination END -->

                        </div><!-- /.table-responsive -->
</div>
        </div><!-- /.table-responsive -->
    </div>
</div>

    @section scripts{
        <script src="~/Plugin/Jquery/jquery.unobtrusive-ajax.min.js"></script>
        <script>
            function addCate() {
                var name = $("#name").val();
                var id = $("#cateid").val();
                $.post("@Url.Action("AddCategory")", { name: name, id: id }, function (data) {
                    if (data.Status == 200) {
                        alert("添加成功!");
                        window.location.reload();
                    } else {
                        alert("保存失败！错误信息：" + data.Message);
                    }
                });
            }

            //首页置顶
            function HomeTop(Obj) {
                var id = $(Obj).attr("data-value");
                $.post("@Url.Action("HomeTop")/" + id, {}, function (data) {
                    if (data.Status != 200) {
                        alert(data);
                    }
                })
            }
            //是否显示
            function HomeShow(Obj) {
                var id = $(Obj).attr("data-value");
                $.post("@Url.Action("HomeShow")/" + id, {}, function (data) {
                    if (data.Status != 200) {
                        alert(data);
                    }
                })
            }
        </script>
    }





